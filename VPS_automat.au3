#include <Misc.au3>

HotKeySet("{Esc}", "Terminate")
;~ HotKeySet("{Home}", "_Wait_Battle")
Func Terminate()
TrayTip("Подсказка", "Программа закрыта, Всего хорошего :)", 1500)
;~ ProcessClose('Bot_WOT_s.exe')
;~ 	Sleep(1000)
	Exit 0
EndFunc   ;==>TerminateS

Opt("SendKeyDelay", 300)          ;5 миллисекунд
Opt("SendKeyDownDelay", 24)      ;1 миллисекунда
Opt("WinTitleMatchMode", -4)     ;1=с началом, 2=частично, 3=точно, 4=расширено, -1 to -4=Nocase
$Title = WinGetTitle ( "VPS-" ) ;часть имени окна
ConsoleWrite('@@ Debug(' & @ScriptLineNumber & ') : $Title = ' & $Title & @CRLF & '>Error code: ' & @error & @CRLF) ;### Debug Console
$hwnd=WinGetHandle($Title)
WinActivate($hwnd)
;~ $send = 'sudo apt-get install ubuntu-desktop'
;~ $send = 'sudo nano /etc/ppp/pptpd-options'
;~ $send = 'sudo nano /etc/pptpd.conf'


;~ $send = 'sudo apt-get update'
;~ $send = 'sudo apt-get install pptp'
;~ $send = 'sudo iptables -A POSTROUTING -t nat -s 192.168.1.0/24 -j MASQUERADE'
;~ $send = 'sudo nano /etc/iptables.rules'
;~ $SEND = '# Generated by iptables-save v1.4.10 on Sat Nov 24 15:25:31 2012{Enter}*nat{Enter}:PREROUTING ACCEPT [258:34197]{Enter}:POSTROUTING ACCEPT [0:0]{Enter}:OUTPUT ACCEPT [0:0]{Enter}-A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE{Enter}COMMIT{Enter}# Completed on Sat Nov 24 15:25:31 2012{Enter}# Generated by iptables-save v1.4.10 on Sat Nov 24 15:25:31 2012{Enter}*mangle{Enter}:PREROUTING ACCEPT [3940:519430]{Enter}:INPUT ACCEPT [1870:247749]{Enter}:FORWARD ACCEPT [1985:253088]{Enter}:OUTPUT ACCEPT [1057:150925]{Enter}:POSTROUTING ACCEPT [3042:404013]{Enter}COMMIT{Enter}# Completed on Sat Nov 24 15:25:31 2012{Enter}# Generated by iptables-save v1.4.10 on Sat Nov 24 15:25:31 2012{Enter}*filter{Enter}:INPUT ACCEPT [1870:247749]{Enter}:FORWARD ACCEPT [1985:253088]{Enter}:OUTPUT ACCEPT [1057:150925]{Enter}COMMIT{Enter}# Completed on Sat Nov 24 15:25:31 2012'
;~ $SEND = '# Generated by iptables-save v1.4.10 on Sat Nov 24 15:25:31 2012{Enter}*nat{Enter}:PREROUTING ACCEPT [258:34197]'
;~ $send = 'sudo nano /etc/init.d/pptpd'
;~ $send = 'iptables-restore < /etc/iptables.rules'
;~ $send = 'sudo nano /etc/sysctl.conf'
;~ $send = 'net.inet.gre.allow=1'
;~ $send = 'sudo nano /etc/ppp/chap-secrets'
;~ $send = 'test * test *'
;~ $send = 'sudo service pptpd restart'
;~ $send = 'sudo ethtool eth0'
;~ $send = 'sudo apt-get install python-pip'
;~ $send = 'sudo pip install speedtest-cli'
;~ $send = 'logfile /var/log/pptpd.log'
$send = 'sudo nano /var/log/pptpd.log'

; Debian 7 pppoE
$send = 'aptitude update'
$send = 'aptitude install openssh-server mc mtr tracert nano tcpdump bind9 pppoe freeradius radiusclient1 rcconf php5'
$send = 'nano /etc/bind/named.conf.options'
$send = 'allow-transfer { none; };|allow-query { 10.128.0.0/16; localhost; }; //podset` nashikh pol`zovatelei`|allow-recursion { 10.128.0.0/16; localhost; }; //rekursiia tol`ko lokal`ny`m|version "My ISP DNS"; //skry`li informatciiu o versii servera'
$send = 'mkdir -p /root-dns/etc'
$send = 'mkdir /root-dns/dev'
$send = 'mkdir -p /root-dns/var/cache/bind'
$send = 'mkdir -p /root-dns/var/run/bind/run'
$send = '/etc/init.d/bind9 stop'
$send = 'nano /etc/default/bind9'
$send = 'OPTIONS="-u bind -t /root-dns"'
$send = 'mv /etc/bind /root-dns/etc'
$send = 'ln -s /root-dns/etc/bind /etc/bind'
$send = 'nano /etc/init.d/bind9'
$send = 'OPTIONS="-u bind -t /root-dns"'
$send = 'nano /etc/init.d/rsyslogd'
$send = 'RSYSLOGD_OPTIONS="-c3 -a /root-dns/dev/log"'
$send = 'chattr +i /root-dns/etc/bind/named.conf'
$send = 'mknod /root-dns/dev/null c 1 3'
;~ $send = 'mknod /root-dns/dev/random c 1 8'
;~ $send = 'chmod 666 /root-dns/dev/null /root-dns/dev/random'
;~ $send = 'chown -R bind:bind /root-dns/var/*'
;~ $send = 'chattr -i /root-dns/etc/bind/named.conf'
;~ $send = 'chown -R bind:bind /root-dns/etc/bind'
;~ $send = '/etc/init.d/bind9 start'






$send = StringReplace($send,'}','IOPTHN')
$send = StringReplace($send,'{','{shiftdown}{{}{shiftup}')
$send = StringReplace($send,'IOPTHN','{shiftdown}]{shiftup}')
$send = StringReplace($send,'!','{!}')
$send = StringReplace($send,'+','{+}')
$send = StringReplace($send,'^','{+}')
$send = StringReplace($send,':','Ж')
$send = StringReplace($send,';','ж')
$send = StringReplace($send,'"','Э')
$send = StringReplace($send,'#','+3')
$send = StringReplace($send,'/','{NUMPADDIV}')
$send = StringReplace($send,'.','{NUMPADDOT}')
;~ send('{sHIFTUP}')
;~ _SplitSend($SEND,'|',0)
;~ {ASC nnnn} Чтобы эмулировать ASCII символ A

;~ controlsend($hwnd,'','',$SEND )
;~ exit
;~ _auth(1)
;~ _auth()


;~ _CommentUncommentAllFile(1)
;~ _SplitSend($SEND)
;~ exit

sleep(100)
;~ send('{CAPSLOCK OFF}')
ConsoleWrite('@@ Debug(' & @ScriptLineNumber & ') : $send = ' & $send & @CRLF & '>Error code: ' & @error & @CRLF) ;### Debug Console
send($send)
sleep(500)
;~ send("{Enter}")

Func _SplitSend($sendForSplit,$delimeters='{Enter}',$flag=1)
	ConsoleWrite('@@ Debug(' & @ScriptLineNumber & ') : $sendForSplit = ' & $sendForSplit & @CRLF & '>Error code: ' & @error & @CRLF) ;### Debug Console
	sleep(100)
	 $SendSplit = StringSplit($sendForSplit,$delimeters,$flag)
		 ConsoleWrite('@@ Debug(' & @ScriptLineNumber & ') : Ubound($SendSplit) = ' & Ubound($SendSplit) & @CRLF & '>Error code: ' & @error & @CRLF) ;### Debug Console
		 send('{CAPSLOCK off}')
	 for $i=1 to Ubound($SendSplit) - 1
;~ 		 $len = StringLen($SendSplit[$i])-2
;~ 		 ConsoleWrite('@@ Debug(' & @ScriptLineNumber & ') : $len = ' & $len & @CRLF & '>Error code: ' & @error & @CRLF) ;### Debug Console
;~ 		 send(StringMid($SendSplit[$i],2,$len))
		 send($SendSplit[$i])
		 ConsoleWrite('@@ Debug(' & @ScriptLineNumber & ') : $SendSplit[$i] = ' & $SendSplit[$i] & @CRLF & '>Error code: ' & @error & @CRLF) ;### Debug Console
		 sleep(500)
		 send('{ENTER}')
		 sleep(500)
	 next
	 exit
endfunc

Func _CommentUncommentAllFile($mod=0)
	sleep(100)
	send('{CAPSLOCK off}')
	while 1
		send('{home}')
		if $mod=0 then
			send('Ж')
		Else
;~ 			send('{BS}')
			send('{DEL}')
		EndIf

		send('{down}')
		sleep(350)
	WEnd
EndFunc


Func _auth($mod=0)
	send("root{Enter}")
;~ 	if $mod=0 then send("administrator{Enter}")
;~ 	send("admin{Enter}")
;~ 	send("user{Enter}")
	sleep(500)
	send("yjds1_")
	sleep(500)
	send("gfh0km")
	sleep(500)
	send("{Enter}")


ConsoleWrite('@@ Debug(' & @ScriptLineNumber & ') : send("{Enter}") = ' & send("{Enter}") & @CRLF & '>Error code: ' & @error & @CRLF) ;### Debug Console
Exit
EndFunc
